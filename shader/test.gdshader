shader_type canvas_item;

// ============ ğŸ”§ å¯è°ƒå‚æ•° ============
uniform vec2 texture_size = vec2(64.0, 64.0);
uniform vec4 base_color = vec4(1.0, 0.0, 0.0, 1.0);
uniform float color_wave_strength = 1;
uniform float flash_speed = 5.0;
uniform float flash_strength = 0.5;
uniform float scale_speed = 3.0;
uniform float scale_range = 0.5;
uniform float edge_softness = 4.0; // ğŸ”¸ è¾¹ç¼˜æŸ”å’Œåº¦(1~4ï¼Œè¶Šå¤§è¶ŠæŸ”)
uniform float mix_strength = 0.5;  // ğŸ”¸ çº¹ç†ä¸è‡ªå®šä¹‰é¢œè‰²æ··åˆæ¯”ä¾‹(0=åªç”¨çº¹ç†,1=åªç”¨shaderé¢œè‰²)

// ============ ğŸ”¹ ç¼©æ”¾åŠ¨ç”» ============
void vertex() {
    float scale = 1.0 + (sin(TIME * scale_speed) * 0.5 + 0.5) * scale_range;
    vec2 center = texture_size * 0.5;
    VERTEX -= center;
    VERTEX *= scale;
    VERTEX += center;
}

// ============ ğŸ”¸ ç«ç„°è§†è§‰æ•ˆæœ ============
void fragment() {
    // 1ï¸âƒ£ åœ†å½¢æ¸å˜é®ç½©
    float dist = distance(UV, vec2(0.5, 0.5));
    float circle_gradient = 1.0 - dist * 1.414;
    circle_gradient = clamp(circle_gradient, 0.0, 1.0);

    // æŸ”å…‰è¾¹ç¼˜ï¼ˆæŒ‡æ•°æ§åˆ¶è¾¹ç¼˜æ¨¡ç³Šç¨‹åº¦ï¼‰
    circle_gradient = pow(circle_gradient, edge_softness);

    // 2ï¸âƒ£ é—ªçƒäº®åº¦
    float flash = 1.0 + sin(TIME * flash_speed) * flash_strength;
    float final_brightness = circle_gradient * flash;

    // 3ï¸âƒ£ é¢œè‰²æ³¢åŠ¨
    float color_wave = (sin(TIME) * 0.5 + 0.5) * color_wave_strength;
    vec4 final_color = vec4(
        base_color.r,
        base_color.g + color_wave,
        base_color.b + color_wave * 0.5,
        base_color.a
    ) * final_brightness;

    // 4ï¸âƒ£ æ··åˆçº¹ç†ï¼ˆæœ‰è´´å›¾æ—¶å åŠ ï¼‰
    vec4 tex = texture(TEXTURE, UV);
    vec4 mixed_color = mix(tex, final_color, mix_strength);

    // 5ï¸âƒ£ ä½¿ç”¨åœ†å½¢é®ç½©æ§åˆ¶é€æ˜åº¦
    mixed_color.a *= circle_gradient;

    COLOR = mixed_color;
}
